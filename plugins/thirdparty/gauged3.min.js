GaugeD3=function(e){"use strict";function t(e){if(U.bindto=e.bindto,U.title.text=e.title.text,U.title.color=e.title.color,e.value.min>e.value.max){var t=e.value.max;e.value.max=e.value.min,e.value.min=t}e.value.min===e.value.max&&(e.value.max=e.value.min+100),U.value.val=Number(e.value.val),U.value.color=e.value.color,U.value.min=Number(e.value.min),U.value.max=Number(e.value.max),U.value.humanFriendly=e.value.humanFriendly,U.value.humanFriendlyDecimal=Number(e.value.humanFriendlyDecimal),U.value.hide=e.value.hide,U.value.hideMinMax=e.value.hideMinMax,U.value.humanFriendlyMinMax=e.value.humanFriendlyMinMax,U.value.decimals=Number(e.value.decimals),U.value.formatNumber=e.value.formatNumber,U.value["class"]=e.value["class"],U.gauge.widthScale=Math.max(0,Math.min(Number(e.gauge.widthScale),1)),U.gauge.color=e.gauge.color,U.gauge.noGradient=e.gauge.noGradient,U.gauge.type=e.gauge.type,-1===_.indexOf(S,U.gauge.type)&&(U.gauge.type=S[0]),U.gauge.donut.startAngle=Math.max(0,Math.min(Number(e.gauge.donut.startAngle),359)),U.label.text=e.label.text,U.label.color=e.label.color,U.label["class"]=e.label["class"],U.level.colors=e.level.colors,U.level.counter=e.level.counter,U.level.customSectors=e.level.customSectors,U.transition.startTime=Number(e.transition.startTime),U.transition.startType=e.transition.startType,U.transition.refreshTime=Number(e.transition.refreshTime),U.transition.refreshType=e.transition.refreshType,U.value.val=l(U.value.val)}function a(e){return"translate("+e.width/2+","+e.height/2+")"}function r(e){var t,a,r,l;switch(e.width>e.height?(a=e.height,r=1.25*a,r>e.width&&(l=r/e.width,r/=l,a/=l)):e.width<e.height?(r=e.width,a=r/1.25,a>e.height&&(l=r/e.height,a/=l,r=a/l)):(r=e.width,a=.75*r),U.gauge.type){case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":t=Math.floor(Math.min(r,a)/I);break;case"donut":t=Math.floor(Math.min(r,a)/G);break;case"half":t=Math.floor(Math.min(r,a)/D);break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":t=Math.floor(Math.min(r,a)/A)}return t}function l(e){return Math.max(U.value.min,Math.min(U.value.max,e))}function i(e,t){var a,r,l,i,n;for(n=!1,0>e&&(n=!0,e*=-1),a=Math.pow,r=a(10,t),l=7;l;)i=a(10,3*l--),e>=i&&(e=Math.round(e*r/i)/r+"KMGTPE"[l]);return n===!0&&(e="-"+e),e}function n(e){var t,a=Math.PI/2;switch(U.gauge.type){case"half":z=-a,F=a;break;case"donut":z=U.gauge.donut.startAngle*B,F=360*B+z;break;case"quarter-left-top":z=-a,F=0;break;case"quarter-right-top":z=0,F=a;break;case"quarter-left-bottom":z=2*a,F=3*a;break;case"quarter-right-bottom":z=a,F=Math.PI;break;case"threequarter-left-top":z=0,F=3*a;break;case"threequarter-right-top":z=a,F=360*B;break;case"threequarter-left-bottom":z=-a,F=Math.PI;break;case"threequarter-right-bottom":z=-Math.PI,F=a;break;case"threequarter-bottom":z=-Math.PI+a/2,F=a+a/2}return t=d3.svg.arc().innerRadius(e-d(e)).outerRadius(e).startAngle(z).endAngle(F)}function o(e,t){return"translate("+e+","+t+")"}function m(e,t,a,r){var l,i=t.insert("path","text").style("fill",r).attr("d",a),n=Math.floor(e/2);switch(U.gauge.type){case"half":l=o(0,n);break;case"quarter-left-top":l=o(n,n);break;case"quarter-right-top":l=o(-1*n,n);break;case"quarter-left-bottom":l=o(n,-1*n);break;case"quarter-right-bottom":l=o(-1*n,-1*n)}return i.attr("transform",l),i}function u(e){var t,a,r,l,i={title:{fontsize:"",dy:"",x:0},value:{fontsize:"",dy:"",x:0},label:{fontsize:"",dy:"",x:0},minmax:{fontsize:"",min_dy:"",max_dy:"",min_x:0,max_x:0}};switch(U.gauge.type){case"half":i.title.fontsize=(1.3*e/N).toFixed(2)+"em",i.value.fontsize=(2.2*e/N).toFixed(2)+"em",i.label.fontsize=(.9*e/N).toFixed(2)+"em",i.minmax.fontsize=(.9*e/N).toFixed(2)+"em",i.title.dy="-4.5em",i.value.dy="1.7em",i.label.dy="5.9em",i.minmax.min_dy=i.minmax.max_dy="5.9em",t=e-d(e)/2,i.minmax.min_x=-t,i.minmax.max_x=t;break;case"donut":i.title.fontsize=(1.3*e/N).toFixed(2)+"em",i.value.fontsize=(2.2*e/N).toFixed(2)+"em",i.label.fontsize=(.9*e/N).toFixed(2)+"em",i.minmax.fontsize=(.9*e/N).toFixed(2)+"em",i.value.dy=".3em",i.label.dy="2.3em",i.title.dy="-1.3em",i.minmax.min_dy=i.minmax.max_dy="7.5em",t=e,i.minmax.min_x=-t,i.minmax.max_x=t;break;case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":switch(i.title.fontsize=(1.3*e/N).toFixed(2)+"em",i.label.fontsize=(.9*e/N).toFixed(2)+"em",i.value.fontsize=(2.2*e/N).toFixed(2)+"em",i.minmax.fontsize=(.9*e/N).toFixed(2)+"em",i.value.dy=".1em",i.label.dy="1.8em",t=e-d(e)/2,U.gauge.type){case"threequarter-left-top":i.title.dy="-2.8em",i.minmax.max_dy="-0.6em",i.title.x=-e/1.5,i.minmax.max_x=-t;break;case"threequarter-right-top":i.title.dy="-2.8em",i.minmax.min_dy="-0.6em",i.title.x=e/1.5,i.minmax.min_x=t;break;case"threequarter-left-bottom":i.title.dy="3.5em",i.minmax.min_dy="1.3em",i.title.x=-e/1.5,i.minmax.min_x=-t;break;case"threequarter-right-bottom":i.title.dy="3.5em",i.minmax.max_dy="1.3em",i.title.x=e/1.5,i.minmax.max_x=t;break;case"threequarter-bottom":i.title.dy="-1.3em",i.value.dy=".3em",i.label.dy="2.2em",i.minmax.min_dy=i.minmax.max_dy="7.8em",i.minmax.max_x=t-e/4,i.minmax.min_x=-t+e/4}break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":switch(i.title.fontsize=(1.3*e/T).toFixed(2)+"em",i.value.fontsize=(2.5*e/T).toFixed(2)+"em",i.label.fontsize=(.9*e/T).toFixed(2)+"em",i.minmax.fontsize=(.9*e/T).toFixed(2)+"em",a=e/2.3,t=e/3,l=e/2,r=l-d(e)/2,U.gauge.type){case"quarter-left-top":i.title.dy="-5em",i.value.dy="1.9em",i.label.dy="7em",i.minmax.min_dy="8.7em",i.minmax.max_dy="-7.9em",i.title.x=-a,i.value.x=t,i.label.x=t,i.minmax.min_x=-r,i.minmax.max_x=l;break;case"quarter-right-top":i.title.dy="-5em",i.value.dy="1.9em",i.label.dy="7em",i.minmax.min_dy="-7.9em",i.minmax.max_dy="8.7em",i.title.x=a,i.value.x=-t,i.label.x=-t,i.minmax.min_x=-l,i.minmax.max_x=r;break;case"quarter-left-bottom":i.title.dy="5em",i.value.dy="-1.7em",i.label.dy="-3.1em",i.minmax.min_dy="8.7em",i.minmax.max_dy="-7.9em",i.title.x=-a,i.value.x=t,i.label.x=t,i.minmax.min_x=l,i.minmax.max_x=-r;break;case"quarter-right-bottom":i.title.dy="5em",i.value.dy="-1.7em",i.label.dy="-3.1em",i.minmax.min_dy="-7.9em",i.minmax.max_dy="8.7em",i.title.x=a,i.value.x=-t,i.label.x=-t,i.minmax.min_x=r,i.minmax.max_x=-l}}return i}function s(e){var t,a,r,l;switch(l=6*e/N,U.gauge.type){case"threequarter-left-top":t=P.min.node().getBBox(),r=e-d(e)/2-t.height/4,a=t.width/2+l,P.min.attr("transform",o(-1*a,-1*r));break;case"threequarter-right-top":t=P.max.node().getBBox(),r=e-d(e)/2-t.height/4,a=t.width/2+l,P.max.attr("transform",o(a,-1*r));break;case"threequarter-left-bottom":t=P.max.node().getBBox(),r=e-d(e)/2+t.height/4,a=t.width/2+l,P.max.attr("transform",o(-1*a,r));break;case"threequarter-right-bottom":t=P.min.node().getBBox(),r=e-d(e)/2+t.height/4,a=t.width/2+l,P.min.attr("transform",o(a,r))}}function c(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function d(e){return Math.floor(U.gauge.widthScale*(e/2.5))}function x(e,t){var a=function(e){return"#"===e.charAt(0)?e.substring(1,7):e};if(U.level.customSectors.length>0){var r=_.findIndex(U.level.customSectors,function(t){return e>t.lo&&e<=t.hi});if(r>=0)return U.level.customSectors[r].color}var l=U.level.colors.length;if(1===l)return U.level.colors[0];for(var i=U.gauge.noGradient?1/l:1/(l-1),n=[],o=0;l>o;o++)n.push({percentage:U.gauge.noGradient?i*(o+1):i*o,color:{r:parseInt(a(U.level.colors[o]).substring(0,2),16),g:parseInt(a(U.level.colors[o]).substring(2,4),16),b:parseInt(a(U.level.colors[o]).substring(4,6),16)}});if(0===t)return"rgb("+[n[0].color.r,n[0].color.g,n[0].color.b].join(",")+")";for(var m,u,s,c,d,x,h,v=0;v<n.length;v++)if(t<=n[v].percentage)return U.gauge.noGradient?"rgb("+[n[v].color.r,n[v].color.g,n[v].color.b].join(",")+")":(x=n[v-1],h=n[v],m=h.percentage-x.percentage,u=(t-x.percentage)/m,s=1-u,c=u,d={r:Math.floor(x.color.r*s+h.color.r*c),g:Math.floor(x.color.g*s+h.color.g*c),b:Math.floor(x.color.b*s+h.color.b*c)},"rgb("+[d.r,d.g,d.b].join(",")+")")}function h(){var e;return e=U.value.humanFriendly?i(U.value.val,U.value.humanFriendlyDecimal):U.value.formatNumber===!0?c(U.value.val):U.value.val}function v(){var e;return e=U.value.humanFriendlyMinMax?i(U.value.min,U.value.humanFriendlyDecimal):U.value.formatNumber===!0?c(U.value.min):U.value.min}function f(){var e;return e=U.value.humanFriendlyMinMax?i(U.value.max,U.value.humanFriendlyDecimal):U.value.formatNumber===!0?c(U.value.max):U.value.max}function b(){var e=w.getBoundingClientRect();P.svg=d3.select("#"+U.bindto).append("svg").attr("width",e.width).attr("height",e.height),P.center=P.svg.append("g").style("opacity",0).attr("transform",a(e));var t=r(e);P.arc=n(t),P.arc_bg=m(t,P.center,P.arc,U.gauge.color),P.arc_level=m(t,P.center,P.arc,x(U.value.val,0)),R=z;var l=u(t);P.title=P.center.append("text").text(U.title.text).style("fill",U.title.color).style("text-anchor","middle").attr("dy",l.title.dy).attr("x",l.title.x).attr("font-size",l.title.fontsize).attr("class",U.title["class"]),P.value=P.center.append("text").data([{value:U.value.val}]).text(h()).style("fill",U.value.color).style("text-anchor","middle").attr("dy",l.value.dy).attr("x",l.value.x).attr("font-size",l.value.fontsize).attr("class",U.value["class"]),P.label=P.center.append("text").text(U.label.text).style("fill",U.label.color).style("text-anchor","middle").attr("dy",l.label.dy).attr("x",l.label.x).attr("font-size",l.label.fontsize).attr("class",U.label["class"]),U.value.hide===!0&&(P.value.style("display","none"),P.label.style("display","none")),P.min=P.center.append("text").text(v()).style("fill",U.label.color).style("text-anchor","middle").attr("dy",l.minmax.min_dy).attr("x",l.minmax.min_x).attr("font-size",l.minmax.fontsize).attr("class",U.label["class"]),P.max=P.center.append("text").text(f()).style("fill",U.label.color).style("text-anchor","middle").attr("dy",l.minmax.max_dy).attr("x",l.minmax.max_x).attr("font-size",l.minmax.fontsize).attr("class",U.label["class"]),U.value.hideMinMax===!0&&(P.min.style("display","none"),P.max.style("display","none")),s(t)}function g(){if(!_.isNull(P.svg)){var e=w.getBoundingClientRect();P.svg.attr("height",e.height).attr("width",e.width),P.center.attr("transform",a(e));var t=r(e);P.arc.innerRadius(t-d(t)).outerRadius(t).endAngle(F),P.arc_bg.remove(),P.arc_bg=m(t,P.center,P.arc,U.gauge.color),P.arc.endAngle(R),P.arc_level.remove(),P.arc_level=m(t,P.center,P.arc,x(U.value.val,0));var l=u(t);P.title.attr("font-size",l.title.fontsize).attr("x",l.title.x),P.value.attr("font-size",l.value.fontsize).attr("x",l.value.x),P.label.attr("font-size",l.label.fontsize).attr("x",l.label.x),P.min.attr("font-size",l.minmax.fontsize).attr("x",l.minmax.min_x),P.max.attr("font-size",l.minmax.fontsize).attr("x",l.minmax.max_x),s(t)}}function y(e){var t,a;return U.value.min<0?U.value.max<0?(a=Math.abs(e+Math.abs(U.value.min)),t=Math.abs(U.value.min)-Math.abs(U.value.max)):(a=e+Math.abs(U.value.min),t=U.value.max+Math.abs(U.value.min)):(a=e-U.value.min,t=U.value.max-U.value.min),100/t*a/100}function p(){P.center.transition().duration(U.transition.startTime).ease(U.transition.startType).style("opacity",1)}function q(e){P.value.transition().duration(U.transition.refreshTime).ease(U.transition.refreshType).tween("text",function(t){var a=d3.interpolate(t.value,e);return t.value=e,function(e){this.textContent=U.value.humanFriendly?i(a(e).toFixed(U.value.humanFriendlyDecimal),U.value.humanFriendlyDecimal):U.value.formatNumber?c(a(e).toFixed(U.value.decimal)):a(e).toFixed(U.value.decimal)}})}function M(e){var t=y(e),a=function(e){var t,a=function(e,t,a){return(t*e+a)*B};switch(U.gauge.type){case"half":t=a(e,180,-90);break;case"donut":t=a(e,360,U.gauge.donut.startAngle);break;case"quarter-left-top":t=a(e,90,-90);break;case"quarter-right-top":t=a(e,90,0);break;case"quarter-left-bottom":t=a(e,90,180);break;case"quarter-right-bottom":t=a(e,90,90);break;case"threequarter-left-top":t=a(e,270,0);break;case"threequarter-right-top":t=a(e,270,90);break;case"threequarter-left-bottom":t=a(e,270,-90);break;case"threequarter-right-bottom":t=a(e,270,-180);break;case"threequarter-bottom":t=a(e,270,-135)}return t}(t);P.arc_level.datum(a),P.arc_level.transition().duration(U.transition.refreshTime).ease(U.transition.refreshType).style("fill",x(e,t)).attrTween("d",function(e){var t=d3.interpolate(R,e);return function(e){return R=t(e),P.arc.endAngle(t(e))()}})}function k(e,t,a){_.isNull(P.svg)||(_.isUndefined(t)||(U.value.min=t,P.min.datum(U.value.min).text(v())),_.isUndefined(a)||(U.value.max=a,P.max.datum(U.value.max).text(f())),e=l(e),U.value.val=e,U.value.transition===!0?q(e):P.value.text(h()),M(e))}var z,F,w=null,N=112,T=Math.floor(1.66*N),B=Math.PI/180,D=2,A=1.3,G=2.15,I=2.15,S=["half","donut","quarter-left-top","quarter-right-top","quarter-left-bottom","quarter-right-bottom","threequarter-left-top","threequarter-right-top","threequarter-left-bottom","threequarter-right-bottom","threequarter-bottom"],P={svg:null,center:null,arc:null,arc_bg:null,arc_level:null,title:null,value:null,label:null,min:null,max:null},R=0,j={bindto:"",title:{text:"",color:"#999999","class":""},value:{val:0,color:"#010101",min:0,max:100,humanFriendly:!1,humanFriendlyDecimal:0,hide:!1,hideMinMax:!1,humanFriendlyMinMax:!1,decimals:0,formatNumber:!1,transition:!0,"class":""},gauge:{widthScale:1,color:"#edebeb",noGradient:!1,type:"half",donut:{startAngle:0}},label:{text:"",color:"#edebeb","class":""},level:{colors:["#a9d70b","#f9c802","#ff0000"],counter:!1,customSectors:[]},transition:{startTime:700,startType:"linear",refreshTime:700,refreshType:"circle-out"}},U=j,C=function(e){return _.isNull(e)||_.isUndefined(e)?(console.error("GaugeD3: Make sure to pass options to the constructor!"),!1):_.isNull(e.bindto)||_.isUndefined(e.bindto)?(console.error("GaugeD3: No element with id : %s found",U.bindto),!1):(w=document.getElementById(e.bindto))?(t(_.merge(j,e)),b(),void p()):(console.error("GaugeD3: No element with id : %s found",e.bindto),!1)}(e);return C===!1?void 0:{resize:function(){g()},refresh:function(e,t,a){k(Number(e),t,a)}}};