GaugeD3=function(e){"use strict";function t(e){if(S.bindto=e.bindto,S.title.text=e.title.text,S.title.color=e.title.color,e.value.min>e.value.max){var t=e.value.max;e.value.max=e.value.min,e.value.min=t}e.value.min===e.value.max&&(e.value.max=e.value.min+100),S.value.val=Number(e.value.val),S.value.color=e.value.color,S.value.min=Number(e.value.min),S.value.max=Number(e.value.max),S.value.humanFriendly=e.value.humanFriendly,S.value.humanFriendlyDecimal=Number(e.value.humanFriendlyDecimal),S.value.hide=e.value.hide,S.value.hideMinMax=e.value.hideMinMax,S.value.humanFriendlyMinMax=e.value.humanFriendlyMinMax,S.value.decimals=Number(e.value.decimals),S.value.formatNumber=e.value.formatNumber,S.value["class"]=e.value["class"],S.gauge.widthScale=Math.max(0,Math.min(Number(e.gauge.widthScale),1)),S.gauge.color=e.gauge.color,S.gauge.noGradient=e.gauge.noGradient,S.gauge.type=e.gauge.type,-1===_.indexOf(P,S.gauge.type)&&(S.gauge.type=P[0]),S.gauge.donut.startAngle=Math.max(0,Math.min(Number(e.gauge.donut.startAngle),359)),S.label.text=e.label.text,S.label.color=e.label.color,S.label["class"]=e.label["class"],S.level.colors=e.level.colors,S.level.counter=e.level.counter,S.level.customSectors=e.level.customSectors,S.transition.startTime=Number(e.transition.startTime),S.transition.startType=e.transition.startType,S.transition.refreshTime=Number(e.transition.refreshTime),S.transition.refreshType=e.transition.refreshType,S.value.val=l(S.value.val)}function a(e){return"translate("+e.width/2+","+e.height/2+")"}function r(e){var t,a,r,l;switch(e.width>e.height?(a=e.height,r=1.25*a,r>e.width&&(l=r/e.width,r/=l,a/=l)):e.width<e.height?(r=e.width,a=r/1.25,a>e.height&&(l=r/e.height,a/=l,r=a/l)):(r=e.width,a=.75*r),S.gauge.type){case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"donut":t=Math.floor(Math.min(r,a)/2.15);break;case"half":t=Math.floor(Math.min(r,a)/2);break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":t=Math.floor(Math.min(r,a)/T)}return t}function l(e){return Math.max(S.value.min,Math.min(S.value.max,e))}function n(e,t){var a,r,l,n,i;for(i=!1,0>e&&(i=!0,e*=-1),a=Math.pow,r=a(10,t),l=7;l;)n=a(10,3*l--),e>=n&&(e=Math.round(e*r/n)/r+"KMGTPE"[l]);return i===!0&&(e="-"+e),e}function i(e){var t;switch(S.gauge.type){case"half":k=-Math.PI/2,z=Math.PI/2;break;case"donut":k=S.gauge.donut.startAngle*I,z=360*I+k;break;case"quarter-left-top":k=-Math.PI/2,z=0;break;case"quarter-right-top":k=0,z=Math.PI/2;break;case"quarter-left-bottom":k=Math.PI,z=Math.PI/2*3;break;case"quarter-right-bottom":k=Math.PI/2,z=Math.PI;break;case"threequarter-left-top":k=0,z=Math.PI/2*3;break;case"threequarter-right-top":k=Math.PI/2,z=360*I;break;case"threequarter-left-bottom":k=-Math.PI/2,z=Math.PI;break;case"threequarter-right-bottom":k=-Math.PI,z=Math.PI/2}return t=d3.svg.arc().innerRadius(e-c(e)).outerRadius(e).startAngle(k).endAngle(z)}function o(e,t,a){var r=t.insert("path","text").style("fill",S.gauge.color).attr("d",a);switch(S.gauge.type){case"half":r.attr("transform","translate(0,"+Math.floor(e/2)+")");break;case"quarter-left-top":r.attr("transform","translate("+Math.floor(e/2)+","+Math.floor(e/2)+")");break;case"quarter-right-top":r.attr("transform","translate(-"+Math.floor(e/2)+","+Math.floor(e/2)+")");break;case"quarter-left-bottom":r.attr("transform","translate("+Math.floor(e/2)+",-"+Math.floor(e/2)+")");break;case"quarter-right-bottom":r.attr("transform","translate(-"+Math.floor(e/2)+",-"+Math.floor(e/2)+")")}return r}function m(e,t,a){var r=t.insert("path","text").style("fill",h(S.value.val,0)).attr("d",a);switch(S.gauge.type){case"half":r.attr("transform","translate(0,"+Math.floor(e/2)+")");break;case"quarter-left-top":r.attr("transform","translate("+Math.floor(e/2)+","+Math.floor(e/2)+")");break;case"quarter-right-top":r.attr("transform","translate(-"+Math.floor(e/2)+","+Math.floor(e/2)+")");break;case"quarter-left-bottom":r.attr("transform","translate("+Math.floor(e/2)+",-"+Math.floor(e/2)+")");break;case"quarter-right-bottom":r.attr("transform","translate(-"+Math.floor(e/2)+",-"+Math.floor(e/2)+")")}return r}function u(e){var t,a,r,l={title:{fontsize:"",dy:"",x:0},value:{fontsize:"",dy:"",x:0},label:{fontsize:"",dy:"",x:0},minmax:{fontsize:"",min_dy:"",max_dy:"",min_x:0,max_x:0}};switch(S.gauge.type){case"half":case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"donut":switch(l.title.fontsize=(1.3*e/F).toFixed(2)+"em",l.value.fontsize=(2.2*e/F).toFixed(2)+"em",l.label.fontsize=(.9*e/F).toFixed(2)+"em",l.minmax.fontsize=(.9*e/F).toFixed(2)+"em",S.gauge.type){case"half":l.title.dy="-4.5em",l.value.dy="1.7em",l.label.dy="5.9em",l.minmax.min_dy=l.minmax.max_dy="5.9em",t=e-c(e)/2,l.minmax.min_x=-t,l.minmax.max_x=t;break;case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"donut":switch(l.title.dy="-1.3em",l.value.dy=".3em",l.label.dy="2.3em",S.gauge.type){case"donut":l.minmax.min_dy=l.minmax.max_dy="7.5em",t=e,l.minmax.min_x=-t,l.minmax.max_x=t;break;case"threequarter-left-top":l.minmax.min_dy="1.3em",l.minmax.max_dy="-0.6em",t=e-c(e)/2,l.minmax.min_x=-t,l.minmax.max_x=-t;break;case"threequarter-right-top":l.minmax.min_dy="-0.6em",l.minmax.max_dy="1.3em",t=e-c(e)/2,l.minmax.min_x=t,l.minmax.max_x=t;break;case"threequarter-left-bottom":l.minmax.min_dy="1.3em",l.minmax.max_dy="-0.6em",t=e-c(e)/2,l.minmax.min_x=-t,l.minmax.max_x=-t;break;case"threequarter-right-bottom":l.minmax.min_dy="-0.6em",l.minmax.max_dy="1.3em",t=e-c(e)/2,l.minmax.min_x=t,l.minmax.max_x=t}}break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":switch(l.title.fontsize=(1.3*e/N).toFixed(2)+"em",l.value.fontsize=(2.5*e/N).toFixed(2)+"em",l.label.fontsize=(.9*e/N).toFixed(2)+"em",l.minmax.fontsize=(.9*e/N).toFixed(2)+"em",a=e/2.3,t=e/3,r=e/2-c(e)/2,S.gauge.type){case"quarter-left-top":l.title.dy="-5em",l.value.dy="1.9em",l.label.dy="7em",l.minmax.min_dy="8.7em",l.minmax.max_dy="8.7em",l.title.x=-a,l.value.x=t,l.label.x=t,l.minmax.min_x=-r,l.minmax.max_x=r;break;case"quarter-right-top":l.title.dy="-5em",l.value.dy="1.9em",l.label.dy="7em",l.minmax.min_dy="8.7em",l.minmax.max_dy="8.7em",l.title.x=a,l.value.x=-t,l.label.x=-t,l.minmax.min_x=-r,l.minmax.max_x=r;break;case"quarter-left-bottom":l.title.dy="5em",l.value.dy="-1.7em",l.label.dy="-3.1em",l.minmax.min_dy="-8em",l.minmax.max_dy="-8em",l.title.x=-a,l.value.x=t,l.label.x=t,l.minmax.min_x=r,l.minmax.max_x=-r;break;case"quarter-right-bottom":l.title.dy="5em",l.value.dy="-1.7em",l.label.dy="-3.1em",l.minmax.min_dy="-8em",l.minmax.max_dy="-8em",l.title.x=a,l.value.x=-t,l.label.x=-t,l.minmax.min_x=r,l.minmax.max_x=-r}}return l}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function c(e){return Math.floor(S.gauge.widthScale*(e/2.5))}function h(e,t){var a=function(e){return"#"===e.charAt(0)?e.substring(1,7):e};if(S.level.customSectors.length>0){var r=_.findIndex(S.level.customSectors,function(t){return e>t.lo&&e<=t.hi});if(r>=0)return S.level.customSectors[r].color}var l=S.level.colors.length;if(1===l)return S.level.colors[0];for(var n=S.gauge.noGradient?1/l:1/(l-1),i=[],o=0;l>o;o++)i.push({percentage:S.gauge.noGradient?n*(o+1):n*o,color:{r:parseInt(a(S.level.colors[o]).substring(0,2),16),g:parseInt(a(S.level.colors[o]).substring(2,4),16),b:parseInt(a(S.level.colors[o]).substring(4,6),16)}});if(0===t)return"rgb("+[i[0].color.r,i[0].color.g,i[0].color.b].join(",")+")";for(var m,u,s,c,h,x,d,f=0;f<i.length;f++)if(t<=i[f].percentage)return S.gauge.noGradient?"rgb("+[i[f].color.r,i[f].color.g,i[f].color.b].join(",")+")":(x=i[f-1],d=i[f],m=d.percentage-x.percentage,u=(t-x.percentage)/m,s=1-u,c=u,h={r:Math.floor(x.color.r*s+d.color.r*c),g:Math.floor(x.color.g*s+d.color.g*c),b:Math.floor(x.color.b*s+d.color.b*c)},"rgb("+[h.r,h.g,h.b].join(",")+")")}function x(){var e;return e=S.value.humanFriendly?n(S.value.val,S.value.humanFriendlyDecimal):S.value.formatNumber===!0?s(S.value.val):S.value.val}function d(){var e;return e=S.value.humanFriendlyMinMax?n(S.value.min,S.value.humanFriendlyDecimal):S.value.formatNumber===!0?s(S.value.min):S.value.min}function f(){var e;return e=S.value.humanFriendlyMinMax?n(S.value.max,S.value.humanFriendlyDecimal):S.value.formatNumber===!0?s(S.value.max):S.value.max}function v(){var e=w.getBoundingClientRect();D.svg=d3.select("#"+S.bindto).append("svg").attr("width",e.width).attr("height",e.height),D.center=D.svg.append("g").style("opacity",0).attr("transform",a(e));var t=r(e);D.arc=i(t),D.arc_bg=o(t,D.center,D.arc),D.arc_level=m(t,D.center,D.arc),A=k;var l=u(t);switch(D.title=D.center.append("text").text(S.title.text).style("fill",S.title.color).style("text-anchor","middle").attr("dy",l.title.dy).attr("x",l.title.x).attr("font-size",l.title.fontsize).attr("class",S.title["class"]),D.value=D.center.append("text").data([{value:S.value.val}]).text(x()).style("fill",S.value.color).style("text-anchor","middle").attr("dy",l.value.dy).attr("x",l.value.x).attr("font-size",l.value.fontsize).attr("class",S.value["class"]),D.label=D.center.append("text").text(S.label.text).style("fill",S.label.color).style("text-anchor","middle").attr("dy",l.label.dy).attr("x",l.label.x).attr("font-size",l.label.fontsize).attr("class",S.label["class"]),S.value.hide===!0&&(D.value.style("display","none"),D.label.style("display","none")),D.min=D.center.append("text").text(d()).style("fill",S.label.color).style("text-anchor","middle").attr("dy",l.minmax.min_dy).attr("x",l.minmax.min_x).attr("font-size",l.minmax.fontsize).attr("class",S.label["class"]),D.max=D.center.append("text").text(f()).style("fill",S.label.color).style("text-anchor","middle").attr("dy",l.minmax.max_dy).attr("x",l.minmax.max_x).attr("font-size",l.minmax.fontsize).attr("class",S.label["class"]),S.value.hideMinMax===!0&&(D.min.style("display","none"),D.max.style("display","none")),S.gauge.type){case"quarter-left-top":D.max.attr("transform","rotate(-90)");break;case"quarter-right-top":D.min.attr("transform","rotate(90)");break;case"quarter-left-bottom":D.min.attr("transform","rotate(90)");break;case"quarter-right-bottom":D.max.attr("transform","rotate(-90)");break;case"threequarter-left-top":D.min.attr("transform","rotate(90)");break;case"threequarter-right-top":D.max.attr("transform","rotate(-90)");break;case"threequarter-left-bottom":D.max.attr("transform","rotate(-90)");break;case"threequarter-right-bottom":D.min.attr("transform","rotate(90)")}}function b(){if(!_.isNull(D.svg)){var e=w.getBoundingClientRect();D.svg.attr("height",e.height).attr("width",e.width),D.center.attr("transform",a(e));var t=r(e);D.arc.innerRadius(t-c(t)).outerRadius(t).endAngle(z),D.arc_bg.remove(),D.arc_bg=o(t,D.center,D.arc),D.arc.endAngle(A),D.arc_level.remove(),D.arc_level=m(t,D.center,D.arc);var l=u(t);D.title.attr("font-size",l.title.fontsize).attr("x",l.title.x),D.value.attr("font-size",l.value.fontsize).attr("x",l.value.x),D.label.attr("font-size",l.label.fontsize).attr("x",l.label.x),D.min.attr("font-size",l.minmax.fontsize).attr("x",l.minmax.min_x),D.max.attr("font-size",l.minmax.fontsize).attr("x",l.minmax.max_x)}}function g(e){var t,a;return S.value.min<0?S.value.max<0?(a=Math.abs(e+Math.abs(S.value.min)),t=Math.abs(S.value.min)-Math.abs(S.value.max)):(a=e+Math.abs(S.value.min),t=S.value.max+Math.abs(S.value.min)):(a=e-S.value.min,t=S.value.max-S.value.min),100/t*a/100}function y(){D.center.transition().duration(S.transition.startTime).ease(S.transition.startType).style("opacity",1)}function p(e){D.value.transition().duration(S.transition.refreshTime).ease(S.transition.refreshType).tween("text",function(t){var a=d3.interpolate(t.value,e);return t.value=e,function(e){this.textContent=S.value.humanFriendly?n(a(e).toFixed(S.value.humanFriendlyDecimal),S.value.humanFriendlyDecimal):S.value.formatNumber?s(a(e).toFixed(S.value.decimal)):a(e).toFixed(S.value.decimal)}})}function M(e){var t=g(e),a=function(e){var t,a=function(e,t,a){return(t*e+a)*I};switch(S.gauge.type){case"half":t=a(e,180,-90);break;case"donut":t=a(e,360,S.gauge.donut.startAngle);break;case"quarter-left-top":t=a(e,90,-90);break;case"quarter-right-top":t=a(e,90,0);break;case"quarter-left-bottom":t=a(e,90,180);break;case"quarter-right-bottom":t=a(e,90,90);break;case"threequarter-left-top":t=a(e,270,0);break;case"threequarter-right-top":t=a(e,270,90);break;case"threequarter-left-bottom":t=a(e,270,-90);break;case"threequarter-right-bottom":t=a(e,270,-180)}return t}(t);D.arc_level.datum(a),D.arc_level.transition().duration(S.transition.refreshTime).ease(S.transition.refreshType).style("fill",h(e,t)).attrTween("d",function(e){var t=d3.interpolate(A,e);return function(e){return A=t(e),D.arc.endAngle(t(e))()}})}function q(e,t,a){_.isNull(D.svg)||(_.isUndefined(t)||(S.value.min=t,D.min.datum(S.value.min).text(d())),_.isUndefined(a)||(S.value.max=a,D.max.datum(S.value.max).text(f())),e=l(e),S.value.val=e,S.value.transition===!0?p(e):D.value.text(x()),M(e))}var k,z,w=null,F=112,N=Math.floor(1.66*F),I=Math.PI/180,T=1.3,P=["half","quarter-left-top","quarter-right-top","quarter-left-bottom","quarter-right-bottom","threequarter-left-top","threequarter-right-top","threequarter-left-bottom","threequarter-right-bottom","donut"],D={svg:null,center:null,arc:null,arc_bg:null,arc_level:null,title:null,value:null,label:null,min:null,max:null},A=0,G={bindto:"",title:{text:"",color:"#999999","class":""},value:{val:0,color:"#010101",min:0,max:100,humanFriendly:!1,humanFriendlyDecimal:0,hide:!1,hideMinMax:!1,humanFriendlyMinMax:!1,decimals:0,formatNumber:!1,transition:!0,"class":""},gauge:{widthScale:1,color:"#edebeb",noGradient:!1,type:"half",donut:{startAngle:0}},label:{text:"",color:"#edebeb","class":""},level:{colors:["#a9d70b","#f9c802","#ff0000"],counter:!1,customSectors:[]},transition:{startTime:700,startType:"linear",refreshTime:700,refreshType:"circle-out"}},S=G,R=function(e){return _.isNull(e)||_.isUndefined(e)?(console.error("GaugeD3: Make sure to pass options to the constructor!"),!1):_.isNull(e.bindto)||_.isUndefined(e.bindto)?(console.error("GaugeD3: No element with id : %s found",S.bindto),!1):(w=document.getElementById(e.bindto))?(t(_.merge(G,e)),v(),void y()):(console.error("GaugeD3: No element with id : %s found",e.bindto),!1)}(e);return R===!1?void 0:{resize:function(){b()},refresh:function(e,t,a){q(Number(e),t,a)}}};