GaugeD3=function(e){"use strict";function t(e){if(E.bindto=e.bindto,E.title.text=e.title.text,E.title.color=e.title.color,e.value.min>e.value.max){var t=e.value.max;e.value.max=e.value.min,e.value.min=t}e.value.min===e.value.max&&(e.value.max=e.value.min+100),E.value.val=Number(e.value.val),E.value.color=e.value.color,E.value.min=Number(e.value.min),E.value.max=Number(e.value.max),E.value.humanFriendly=e.value.humanFriendly,E.value.humanFriendlyDecimal=Number(e.value.humanFriendlyDecimal),E.value.hide=e.value.hide,E.value.hideMinMax=e.value.hideMinMax,E.value.humanFriendlyMinMax=e.value.humanFriendlyMinMax,E.value.decimals=Number(e.value.decimals),E.value.formatNumber=e.value.formatNumber,E.value["class"]=e.value["class"],E.gauge.widthScale=Math.max(0,Math.min(Number(e.gauge.widthScale),1)),E.gauge.color=e.gauge.color,E.gauge.noGradient=e.gauge.noGradient,E.gauge.type=e.gauge.type,-1===_.indexOf(P,E.gauge.type)&&(E.gauge.type=P[0]),E.gauge.donut.startAngle=Math.max(0,Math.min(Number(e.gauge.donut.startAngle),359)),E.label.text=e.label.text,E.label.color=e.label.color,E.label["class"]=e.label["class"],E.level.colors=e.level.colors,E.level.counter=e.level.counter,E.level.customSectors=e.level.customSectors,E.transition.startTime=Number(e.transition.startTime),E.transition.startType=e.transition.startType,E.transition.refreshTime=Number(e.transition.refreshTime),E.transition.refreshType=e.transition.refreshType,E.value.val=i(E.value.val)}function a(e){return"translate("+e.width/2+","+e.height/2+")"}function r(e){var t,a,r;return e.width>e.height?(t=e.height,a=1.25*t,a>e.width&&(r=a/e.width,a/=r,t/=r)):e.width<e.height?(a=e.width,t=a/1.25,t>e.height&&(r=a/e.height,t/=r,width=t/r)):(a=e.width,t=.75*a),{height:t,width:a}}function l(e){var t;switch(E.gauge.type){case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":t=Math.floor(Math.min(e.width,e.height)/A);break;case"donut":t=Math.floor(Math.min(e.width,e.height)/S);break;case"half":t=Math.floor(Math.min(e.width,e.height)/G);break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":t=Math.floor(Math.min(e.width,e.height)/I)}return t}function i(e){return Math.max(E.value.min,Math.min(E.value.max,e))}function n(e,t){var a,r,l,i,n;for(n=!1,0>e&&(n=!0,e*=-1),a=Math.pow,r=a(10,t),l=7;l;)i=a(10,3*l--),e>=i&&(e=Math.round(e*r/i)/r+"KMGTPE"[l]);return n===!0&&(e="-"+e),e}function o(e){var t,a=Math.PI/2;switch(E.gauge.type){case"half":F=-a,z=a;break;case"donut":F=E.gauge.donut.startAngle*D,z=360*D+F;break;case"quarter-left-top":F=-a,z=0;break;case"quarter-right-top":F=0,z=a;break;case"quarter-left-bottom":F=2*a,z=3*a;break;case"quarter-right-bottom":F=a,z=Math.PI;break;case"threequarter-left-top":F=0,z=3*a;break;case"threequarter-right-top":F=a,z=360*D;break;case"threequarter-left-bottom":F=-a,z=Math.PI;break;case"threequarter-right-bottom":F=-Math.PI,z=a;break;case"threequarter-bottom":F=-Math.PI+a/2,z=a+a/2}return t=d3.svg.arc().innerRadius(e-d(e)).outerRadius(e).startAngle(F).endAngle(z)}function m(e,t){return"translate("+e+","+t+")"}function u(e,t,a,r){var l,i=t.insert("path","text").style("fill",r).attr("d",a),n=Math.floor(e/2);switch(E.gauge.type){case"half":l=m(0,n);break;case"quarter-left-top":l=m(n,n);break;case"quarter-right-top":l=m(-1*n,n);break;case"quarter-left-bottom":l=m(n,-1*n);break;case"quarter-right-bottom":l=m(-1*n,-1*n)}return i.attr("transform",l),i}function s(e){var t,a,r,l,i={title:{fontsize:"",dy:"",x:0},value:{fontsize:"",dy:"",x:0},label:{fontsize:"",dy:"",x:0},minmax:{fontsize:"",min_dy:"",max_dy:"",min_x:0,max_x:0}};switch(E.gauge.type){case"half":i.title.fontsize=(1.3*e/T).toFixed(2)+"em",i.value.fontsize=(2.2*e/T).toFixed(2)+"em",i.label.fontsize=(.9*e/T).toFixed(2)+"em",i.minmax.fontsize=(.9*e/T).toFixed(2)+"em",i.title.dy="-4.5em",i.value.dy="1.7em",i.label.dy="5.9em",i.minmax.min_dy=i.minmax.max_dy="5.9em",t=e-d(e)/2,i.minmax.min_x=-t,i.minmax.max_x=t;break;case"donut":i.title.fontsize=(1.3*e/T).toFixed(2)+"em",i.value.fontsize=(2.2*e/T).toFixed(2)+"em",i.label.fontsize=(.9*e/T).toFixed(2)+"em",i.minmax.fontsize=(.9*e/T).toFixed(2)+"em",i.value.dy=".3em",i.label.dy="2.3em",i.title.dy="-1.3em",i.minmax.min_dy=i.minmax.max_dy="7.5em",t=e,i.minmax.min_x=-t,i.minmax.max_x=t;break;case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":switch(i.title.fontsize=(1.3*e/T).toFixed(2)+"em",i.label.fontsize=(.9*e/T).toFixed(2)+"em",i.value.fontsize=(2.2*e/T).toFixed(2)+"em",i.minmax.fontsize=(.9*e/T).toFixed(2)+"em",i.value.dy=".1em",i.label.dy="1.8em",t=e-d(e)/2,E.gauge.type){case"threequarter-left-top":i.title.dy="-2.8em",i.minmax.max_dy="-0.6em",i.title.x=-e/1.5,i.minmax.max_x=-t;break;case"threequarter-right-top":i.title.dy="-2.8em",i.minmax.min_dy="-0.6em",i.title.x=e/1.5,i.minmax.min_x=t;break;case"threequarter-left-bottom":i.title.dy="3.5em",i.minmax.min_dy="1.3em",i.title.x=-e/1.5,i.minmax.min_x=-t;break;case"threequarter-right-bottom":i.title.dy="3.5em",i.minmax.max_dy="1.3em",i.title.x=e/1.5,i.minmax.max_x=t;break;case"threequarter-bottom":i.title.dy="-1.3em",i.value.dy=".3em",i.label.dy="2.2em",i.minmax.min_dy=i.minmax.max_dy="7.8em",i.minmax.max_x=t-e/4,i.minmax.min_x=-t+e/4}break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":switch(i.title.fontsize=(1.3*e/B).toFixed(2)+"em",i.value.fontsize=(2.5*e/B).toFixed(2)+"em",i.label.fontsize=(.9*e/B).toFixed(2)+"em",i.minmax.fontsize=(.9*e/B).toFixed(2)+"em",a=e/2.3,t=e/3,l=e/2,r=l-d(e)/2,E.gauge.type){case"quarter-left-top":i.title.dy="-5em",i.value.dy="1.9em",i.label.dy="7em",i.minmax.min_dy="8.7em",i.minmax.max_dy="-7.9em",i.title.x=-a,i.value.x=t,i.label.x=t,i.minmax.min_x=-r,i.minmax.max_x=l;break;case"quarter-right-top":i.title.dy="-5em",i.value.dy="1.9em",i.label.dy="7em",i.minmax.min_dy="-7.9em",i.minmax.max_dy="8.7em",i.title.x=a,i.value.x=-t,i.label.x=-t,i.minmax.min_x=-l,i.minmax.max_x=r;break;case"quarter-left-bottom":i.title.dy="5em",i.value.dy="-1.7em",i.label.dy="-3.1em",i.minmax.min_dy="8.7em",i.minmax.max_dy="-7.9em",i.title.x=-a,i.value.x=t,i.label.x=t,i.minmax.min_x=l,i.minmax.max_x=-r;break;case"quarter-right-bottom":i.title.dy="5em",i.value.dy="-1.7em",i.label.dy="-3.1em",i.minmax.min_dy="-7.9em",i.minmax.max_dy="8.7em",i.title.x=a,i.value.x=-t,i.label.x=-t,i.minmax.min_x=r,i.minmax.max_x=-l}}return i}function c(e){var t,a,r,l;switch(l=6*e/T,E.gauge.type){case"threequarter-left-top":t=R.min.node().getBBox(),r=e-d(e)/2-t.height/4,a=t.width/2+l,R.min.attr("transform",m(-1*a,-1*r));break;case"threequarter-right-top":t=R.max.node().getBBox(),r=e-d(e)/2-t.height/4,a=t.width/2+l,R.max.attr("transform",m(a,-1*r));break;case"threequarter-left-bottom":t=R.max.node().getBBox(),r=e-d(e)/2+t.height/4,a=t.width/2+l,R.max.attr("transform",m(-1*a,r));break;case"threequarter-right-bottom":t=R.min.node().getBBox(),r=e-d(e)/2+t.height/4,a=t.width/2+l,R.min.attr("transform",m(a,r))}}function h(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function d(e){return Math.floor(E.gauge.widthScale*(e/2.5))}function x(e,t){var a=function(e){return"#"===e.charAt(0)?e.substring(1,7):e};if(E.level.customSectors.length>0){var r=_.findIndex(E.level.customSectors,function(t){return e>t.lo&&e<=t.hi});if(r>=0)return E.level.customSectors[r].color}var l=E.level.colors.length;if(1===l)return E.level.colors[0];for(var i=E.gauge.noGradient?1/l:1/(l-1),n=[],o=0;l>o;o++)n.push({percentage:E.gauge.noGradient?i*(o+1):i*o,color:{r:parseInt(a(E.level.colors[o]).substring(0,2),16),g:parseInt(a(E.level.colors[o]).substring(2,4),16),b:parseInt(a(E.level.colors[o]).substring(4,6),16)}});if(0===t)return"rgb("+[n[0].color.r,n[0].color.g,n[0].color.b].join(",")+")";for(var m,u,s,c,h,d,x,v=0;v<n.length;v++)if(t<=n[v].percentage)return E.gauge.noGradient?"rgb("+[n[v].color.r,n[v].color.g,n[v].color.b].join(",")+")":(d=n[v-1],x=n[v],m=x.percentage-d.percentage,u=(t-d.percentage)/m,s=1-u,c=u,h={r:Math.floor(d.color.r*s+x.color.r*c),g:Math.floor(d.color.g*s+x.color.g*c),b:Math.floor(d.color.b*s+x.color.b*c)},"rgb("+[h.r,h.g,h.b].join(",")+")")}function v(){var e;return e=E.value.humanFriendly?n(E.value.val,E.value.humanFriendlyDecimal):E.value.formatNumber===!0?h(E.value.val):E.value.val}function b(){var e;return e=E.value.humanFriendlyMinMax?n(E.value.min,E.value.humanFriendlyDecimal):E.value.formatNumber===!0?h(E.value.min):E.value.min}function f(){var e;return e=E.value.humanFriendlyMinMax?n(E.value.max,E.value.humanFriendlyDecimal):E.value.formatNumber===!0?h(E.value.max):E.value.max}function g(){var e=N.getBoundingClientRect();R.svg=d3.select("#"+E.bindto).append("svg").attr("width",e.width).attr("height",e.height),R.center=R.svg.append("g").style("opacity",0).attr("transform",a(e)),U=r(e);var t=l(U);R.arc=o(t),R.arc_bg=u(t,R.center,R.arc,E.gauge.color),R.arc_level=u(t,R.center,R.arc,x(E.value.val,0)),j=F;var i=s(t);R.title=R.center.append("text").text(E.title.text).style("fill",E.title.color).style("text-anchor","middle").attr("dy",i.title.dy).attr("x",i.title.x).attr("font-size",i.title.fontsize).attr("class",E.title["class"]),R.value=R.center.append("text").data([{value:E.value.val}]).text(v()).style("fill",E.value.color).style("text-anchor","middle").attr("dy",i.value.dy).attr("x",i.value.x).attr("font-size",i.value.fontsize).attr("class",E.value["class"]),R.label=R.center.append("text").text(E.label.text).style("fill",E.label.color).style("text-anchor","middle").attr("dy",i.label.dy).attr("x",i.label.x).attr("font-size",i.label.fontsize).attr("class",E.label["class"]),E.value.hide===!0&&(R.value.style("display","none"),R.label.style("display","none")),R.min=R.center.append("text").text(b()).style("fill",E.label.color).style("text-anchor","middle").attr("dy",i.minmax.min_dy).attr("x",i.minmax.min_x).attr("font-size",i.minmax.fontsize).attr("class",E.label["class"]),R.max=R.center.append("text").text(f()).style("fill",E.label.color).style("text-anchor","middle").attr("dy",i.minmax.max_dy).attr("x",i.minmax.max_x).attr("font-size",i.minmax.fontsize).attr("class",E.label["class"]),E.value.hideMinMax===!0&&(R.min.style("display","none"),R.max.style("display","none")),c(t)}function y(){if(!_.isNull(R.svg)){var e=N.getBoundingClientRect(),t=r(e);R.svg.attr("height",e.height).attr("width",e.width);var l=t.width/U.width,i=t.height/U.height;R.center.attr("transform",a(e)+",scale("+l+", "+i+")")}}function p(e){var t,a;return E.value.min<0?E.value.max<0?(a=Math.abs(e+Math.abs(E.value.min)),t=Math.abs(E.value.min)-Math.abs(E.value.max)):(a=e+Math.abs(E.value.min),t=E.value.max+Math.abs(E.value.min)):(a=e-E.value.min,t=E.value.max-E.value.min),100/t*a/100}function q(){R.center.transition().duration(E.transition.startTime).ease(E.transition.startType).style("opacity",1)}function M(e){R.value.transition().duration(E.transition.refreshTime).ease(E.transition.refreshType).tween("text",function(t){var a=d3.interpolate(t.value,e);return t.value=e,function(e){this.textContent=E.value.humanFriendly?n(a(e).toFixed(E.value.humanFriendlyDecimal),E.value.humanFriendlyDecimal):E.value.formatNumber?h(a(e).toFixed(E.value.decimal)):a(e).toFixed(E.value.decimal)}})}function w(e,t){var a=p(e),r=x(e,a),l=x(t,p(t)),i=function(e){var t,a=function(e,t,a){return(t*e+a)*D};switch(E.gauge.type){case"half":t=a(e,180,-90);break;case"donut":t=a(e,360,E.gauge.donut.startAngle);break;case"quarter-left-top":t=a(e,90,-90);break;case"quarter-right-top":t=a(e,90,0);break;case"quarter-left-bottom":t=a(e,90,180);break;case"quarter-right-bottom":t=a(e,90,90);break;case"threequarter-left-top":t=a(e,270,0);break;case"threequarter-right-top":t=a(e,270,90);break;case"threequarter-left-bottom":t=a(e,270,-90);break;case"threequarter-right-bottom":t=a(e,270,-180);break;case"threequarter-bottom":t=a(e,270,-135)}return t}(a);R.arc_level.datum(i),R.arc_level.transition().duration(E.transition.refreshTime).ease(E.transition.refreshType).styleTween("fill",function(){return d3.interpolateRgb(l,r)}).attrTween("d",function(e){var t=d3.interpolate(j,e);return function(e){return j=t(e),R.arc.endAngle(t(e))()}})}function k(e,t,a){_.isNull(R.svg)||(_.isUndefined(t)||(E.value.min=t,R.min.datum(E.value.min).text(b())),_.isUndefined(a)||(E.value.max=a,R.max.datum(E.value.max).text(f())),e=i(e),E.value.transition===!0?M(e):R.value.text(v()),w(e,E.value.val),E.value.val=e)}var F,z,N=null,T=112,B=Math.floor(1.66*T),D=Math.PI/180,G=2,I=1.3,S=2.15,A=2.15,P=["half","donut","quarter-left-top","quarter-right-top","quarter-left-bottom","quarter-right-bottom","threequarter-left-top","threequarter-right-top","threequarter-left-bottom","threequarter-right-bottom","threequarter-bottom"],R={svg:null,center:null,arc:null,arc_bg:null,arc_level:null,title:null,value:null,label:null,min:null,max:null},j=0,U={height:0,width:0},C={bindto:"",title:{text:"",color:"#999999","class":""},value:{val:0,color:"#010101",min:0,max:100,humanFriendly:!1,humanFriendlyDecimal:0,hide:!1,hideMinMax:!1,humanFriendlyMinMax:!1,decimals:0,formatNumber:!1,transition:!0,"class":""},gauge:{widthScale:1,color:"#edebeb",noGradient:!1,type:"half",donut:{startAngle:0}},label:{text:"",color:"#edebeb","class":""},level:{colors:["#a9d70b","#f9c802","#ff0000"],counter:!1,customSectors:[]},transition:{startTime:700,startType:"linear",refreshTime:700,refreshType:"circle-out"}},E=C,K=function(e){return _.isNull(e)||_.isUndefined(e)?(console.error("GaugeD3: Make sure to pass options to the constructor!"),!1):_.isNull(e.bindto)||_.isUndefined(e.bindto)?(console.error("GaugeD3: No element with id : %s found",E.bindto),!1):(N=document.getElementById(e.bindto))?(t(_.merge(C,e)),g(),void q()):(console.error("GaugeD3: No element with id : %s found",e.bindto),!1)}(e);return K===!1?void 0:{resize:function(){y()},refresh:function(e,t,a){k(Number(e),t,a)}}};